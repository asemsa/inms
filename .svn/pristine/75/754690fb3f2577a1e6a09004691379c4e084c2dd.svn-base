<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

use App\User;
use App\Assign;

class AssignController extends Controller
{
    //


    public function assign(){
        //baca data assigns dari database
        $assigns = Assign::all();
        return view('coordinator.assign')
            ->with('assigns', $assigns);
    }

    public function noStd(){
    	$count = 0;
		Assign::truncate();//reset table assign

    	$student = User::where('position', 5);
    	$facultysv = User::where('position', 3);

    	$noStd = $student->count();

    	$getStudents = $student->get()->toArray();
    	$getFacultysv = $facultysv->get()->toArray();

    	for ($i=0; $i < $noStd; $i++) { 
    		$assign = new Assign();
    		if(empty($getFacultysv[$i]['id'])){
    			if($getFacultysv[$count]['id'] == null){
    				$count = 0;
    			}
    			$assign->studentID = $getStudents[$i]['id'];
    			$assign->facultySVID = $getFacultysv[$count]['id'];
    			$count += 1;
    		}else{
    			$assign->studentID = $getStudents[$i]['id'];
    			$assign->facultySVID = $getFacultysv[$i]['id'];
    		}
    		$assign->save();
    	}

    	$assigns = Assign::all();

    	return view('coordinator.assign')
            ->with('assigns', $assigns);
    }

    public function assign_industrialsv(){
        $industrialsvs = User::where('position', 4)->get();
        $assisgnsv = Assign::where('studentID', Auth::user()->id)->first();
        return view('student.assign')
                ->with('industrialsvs', $industrialsvs)
                ->with('assisgnsv', $assisgnsv);
    }

    public function assign_add_industrialsv(Request $request){
        $assign = Assign::where('studentID', Auth::user()->id)->first();
        if(empty($assign)){
            $assign = new Assign();
        }
        $assign->studentID = Auth::user()->id;
        $assign->industrialSVID = $request->industrialsv;
        $assign->save();
        $industrialsvs = User::where('position', 4)->get();
        return redirect('/student/assign/industrialsv')
            ->with('success', 'Successfully assign industrial supervisor!');
    }
}

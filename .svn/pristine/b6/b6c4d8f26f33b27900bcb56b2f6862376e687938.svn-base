<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Announcements;
use Carbon\Carbon;

class GeneralController extends Controller
{
    //
    //
    public function __construct(){
    	$this->middleware('auth');
    }

    public function announcements_add(Request $request){

        //validation
        // $this->validate($request, [
        //     'title' => 'required',
        //     'description' => 'required',
        //     'attachment' => 'image|mimes:jpg,png,jpeg',
        //     'publish' => 'required',
        // ]);

        $announcement = new Announcements;
        $announcement->title = $request->title;
        $announcement->description = $request->description;
        $announcement->publish = $request->publish;
        $announcement->date = Carbon::now();
        
        if ($request->hasFile('attachment')) {

            $image = $request->attachment;
            $filename  = time();

            $announcement->attachment = $filename.".jpg";

            $path = public_path('img/attachments/announcements/'.$filename.".jpg");
            $image = Image::make($image->getRealPath());
            $original = $image->save($path);

        }

        $announcement->save();                    

    	return redirect('/coordinator/announcement')->with('success', "Announcement Successfully Created!");
    }
}
